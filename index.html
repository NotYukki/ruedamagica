<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üé¥ Rueda Magica</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(-45deg, #ff6ec4, #7873f5, #42e695, #f4f4f4);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: white;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h1 {
      font-size: 32px;
      margin-bottom: 20px;
      text-shadow: 1px 1px 4px #000;
      z-index: 1;
    }

    canvas {
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(6px);
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    button {
      margin: 10px;
      padding: 12px 28px;
      font-size: 16px;
      font-weight: bold;
      background: linear-gradient(135deg, #00adb5, #007b7f);
      color: white;
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      z-index: 1;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }

    button:disabled {
      background: #007b7f;
      cursor: wait;
    }

    #result {
      font-size: 28px;
      margin-top: 20px;
      text-shadow: 1px 1px 2px #000;
    }
  </style>
</head>
<body>
  <h1>üé° Roue de l arnaque</h1>
  <canvas id="wheel" width="400" height="400"></canvas>
  <div id="result">‚ùì</div>
  <button id="spinBtn"> Tourner</button>
  <button id="removeBtn" disabled>üóëÔ∏è Dehors</button>

  <audio id="randomSound" preload="auto"></audio>
  <audio id="explosionSound" src="https://www.soundjay.com/explosion/sounds/explosion-01.mp3" preload="auto"></audio>

  <script>
    const prenoms = {
      "Ismael": 20, "Lavrin": 20, "Sean": 20, "Lou": 20, "Sarah": 20,
      "Mohamed": 20, "Tom": 20, "Younes": 20, "Lina": 20, "Mathis": 20,
      "Leo": 20, "Mathias": 20, "Idriss": 20, "Amir": 20, "Yoann": 20,
      "Ewan": 20, "Sakina": 20, "Sairam": 20, "Steven": 20, "Ruben": 20,
      "Guillaume": 20, "Dorian": 20, "Corentin": 20
    };

    let pool = genererPool();
    let dernierPrenom = "";

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const removeBtn = document.getElementById('removeBtn');
    const result = document.getElementById('result');
    const randomSound = document.getElementById('randomSound');
    const explosionSound = document.getElementById('explosionSound');

    const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#9CCC65', '#FF8A65', '#BA68C8'];

    function genererPool() {
      const pool = [];
      for (const [nom, poids] of Object.entries(prenoms)) {
        for (let i = 0; i < poids; i++) pool.push(nom);
      }
      return pool;
    }

    function tirerPrenom() {
      if (pool.length === 0) return null;
      let choisi;
      do {
        const index = Math.floor(Math.random() * pool.length);
        choisi = pool[index];
      } while (choisi === dernierPrenom && pool.length > 1);
      dernierPrenom = choisi;
      return choisi;
    }

    function dessinerRoue(noms, angleOffset = 0) {
      const total = noms.length;
      const angleParNom = 2 * Math.PI / total;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      noms.forEach((nom, i) => {
        const angleStart = angleOffset + i * angleParNom;
        const angleEnd = angleStart + angleParNom;
        ctx.beginPath();
        ctx.moveTo(200, 200);
        ctx.arc(200, 200, 180, angleStart, angleEnd);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate(angleStart + angleParNom / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#fff";
        ctx.font = "16px Arial";
        ctx.fillText(nom, 160, 5);
        ctx.restore();
      });
    }

    function jouerSonAleatoire() {
      const numero = Math.floor(Math.random() * 24) + 1; // 1 √† 10
      randomSound.src = `${numero}.mp3`;
      randomSound.play().catch(e => console.warn("Erreur audio :", e));
    }

    const nomsVisibles = Object.keys(prenoms);
    dessinerRoue(nomsVisibles);

    spinBtn.addEventListener('click', () => {
      if (nomsVisibles.length === 0) return;
      spinBtn.disabled = true;
      result.textContent = "‚è≥";

      const nomChoisi = tirerPrenom();
      if (!nomChoisi) {
        result.textContent = "üéâ Tous les pr√©noms ont √©t√© tir√©s !";
        return;
      }

      const indexChoisi = nomsVisibles.indexOf(nomChoisi);
      const angleParNom = 2 * Math.PI / nomsVisibles.length;
      const angleCible = (3 * Math.PI / 2) - (indexChoisi * angleParNom + angleParNom / 2);
      const tours = 5;
      const angleFinal = tours * 2 * Math.PI + angleCible;

      let angle = 0;
      let start = null;

      jouerSonAleatoire();

      function animer(timestamp) {
        if (!start) start = timestamp;
        const progress = (timestamp - start) / 3000;
        angle = easeOutCubic(progress) * angleFinal;
        dessinerRoue(nomsVisibles, angle);
        if (progress < 1) {
          requestAnimationFrame(animer);
        } else {
          explosionSound.currentTime = 0;
          explosionSound.play();
          result.textContent = nomChoisi;
          removeBtn.disabled = false;
          spinBtn.disabled = false;
        }
      }

      requestAnimationFrame(animer);
    });

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    removeBtn.addEventListener("click", () => {
      if (dernierPrenom && prenoms.hasOwnProperty(dernierPrenom)) {
        delete prenoms[dernierPrenom];
        const idx = nomsVisibles.indexOf(dernierPrenom);
        if (idx !== -1) nomsVisibles.splice(idx, 1);
        pool = genererPool();
        removeBtn.disabled = true;
        result.textContent = `‚ùå ${dernierPrenom} supprim√©`;
        dessinerRoue(nomsVisibles);
      }
    });
  </script>
</body>
</html>
